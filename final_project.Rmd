---
title: 'Final Project: Dog Breeds'
author: "DÃ¡vid Winkler"
date: "2023-06-17"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(shiny)
```

# The dataset

In this project I will work with the tidytuesday 2022-02-01 dataset named Dog Breeds.The data is consisted from various characteristics of different dog breeds. You can check the descriptions of the traits in the trait_description dataset. You can also find the explanation of the values there. Generally the higher value represents the presence of the characteristics in the dog breed from 1 to 5. The coat types and coat lenghts are described with words. On default they are all set to character type variables.   



# Research question

In this assignment I will set up a hierarchical regression model to predict the barking nature of the dogs. My research will focus on the behavioural predictors of this ability, therefoe my predictions will not be based on any of the fur based qualities. It seems logical for me that the classic defender qualities of dogs, like Watchdog/Protective Nature and Openness To strangers could heavily influence the barking level of dogs. I would like to investigate on which extend are the other dog personality characteristics taking part in this behaviour.    

# Research method

I will make two models and I will compare them based on accuracy which is better to predict the barking level of those animals. From the research i will exclude the fur based qualities.  





```{r}
library(readxl) 
library(dplyr)
library(ggplot2)
library(ggrepel)
library(broom)
library(car) # For vif

breed_traits <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-01/breed_traits.csv')
trait_description <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-01/trait_description.csv')
breed_rank_all <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-01/breed_rank.csv')


```

## Exploratory data analysis
### Data diagnostics and correcting coding errors


Run an exploratory data analysis (EDA) to investigate the dataset. filter for most barking dogs with stranger openess and watchdog/protective nature. make shiny ggplot with their yearly ranks, 

```{r}
nrow(breed_traits) # We have 195 breeds.
# First we filter out the fur based qualities
breed_traits_filtered <- breed_traits %>%
  select(-c("Shedding Level", "Coat Grooming Frequency", "Drooling Level", "Coat Type", "Coat Length"))

# Now we set every data to numeric from character except Breed

breed_traits_filtered <- breed_traits_filtered %>%
  mutate(across(-Breed, as.numeric))

str(breed_traits_filtered) # Checking if we were successful

range(breed_traits_filtered$'Affectionate With Family') # Should be between 1-5, output indicates, there is some error in the data

filtered_breeds <- breed_traits_filtered %>%
  filter(`Affectionate With Family` < 1 | `Affectionate With Family` > 5) %>%  
  select(Breed)
range(breed_traits_filtered$'Affectionate With Family') # It is Plott Hounds

breed_traits_filtered <- breed_traits_filtered %>%
  filter(between(`Affectionate With Family`, 1, 5))

range(breed_traits_filtered$'Affectionate With Family') # Should be between 1-5
range(breed_traits_filtered$'Good With Young Children') # Should be between 1-5
range(breed_traits_filtered$'Good With Other Dogs') # Should be between 1-5
range(breed_traits_filtered$'Openness To Strangers') # Should be between 1-5
range(breed_traits_filtered$'Playfulness Level') # Should be between 1-5
range(breed_traits_filtered$'Watchdog/Protective Nature') # Should be between 1-5
range(breed_traits_filtered$'Adaptability Level') # Should be between 1-5
range(breed_traits_filtered$'Trainability Level') # Should be between 1-5
range(breed_traits_filtered$'Energy Level') # Should be between 1-5
range(breed_traits_filtered$'Barking Level') # Should be between 1-5
range(breed_traits_filtered$'Mental Stimulation Needs') # Should be between 1-5
range(breed_traits_filtered$'Affectionate With Family') # Should be between 1-5

# Outputs are indicating, that there are no more coding errors, or missing data
```

### Making a scatter plot

In this scatter plot you can observe the average barking levels for different dog breeds with their respective personalities. The number of observations are also highlighted.   

```{r}
breed_traits_summary <- breed_traits_filtered %>%
  group_by(`Openness To Strangers`, `Watchdog/Protective Nature`) %>%
  summarize(avg_Barking_Level = mean(`Barking Level`), num_breeds = n_distinct(Breed))

ggplot(breed_traits_summary, aes(x = `Openness To Strangers`, y = `Watchdog/Protective Nature`, color = avg_Barking_Level, label = num_breeds)) +
  geom_point() +
  geom_text_repel(size = 3, nudge_x = 0.1, nudge_y = 0.1) +
  labs(x = "Openness To Strangers", y = "Watchdog/Protective Nature", color = "Average Barking Level") +
  scale_color_gradient(low = "blue", high = "red")
 

 
```
### Making a bar plot

In this bar plot you can observe the barking levels for every dog breed.   

```{r}
# Count the number of breeds for each Barking Level category
breed_counts <- breed_traits_filtered %>%
  count(`Barking Level`)

# Create a bar plot of breed counts by Barking Level
ggplot(breed_counts, aes(x = factor(`Barking Level`), y = n)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(x = "Barking Level", y = "Number of Breeds") +
  geom_text(aes(label = n, y = n), vjust = -0.5, color = "orange", size = 3) +
  scale_x_discrete(labels = c("1", "2", "3", "4", "5")) 
  
 
```
### Interactive ggplot, representing the relationship between the dogs nature and the Barking Level

In this interactive plot you can set the Watchdog/Protective Nature and Openess To Strangers variables as you wish, to get the average Barking Level for those observations.Keep in mind, that there were unobserved combinations. (This part of the document interrupts the run all function in R)  
```{r}
# Define the UI
ui <- fluidPage(
  titlePanel("Barking Level Analysis"),
  sidebarLayout(
    sidebarPanel(
      sliderInput("watchdog", "Watchdog/Protective Nature:",
                  min = 1, max = 5, value = 3),
      sliderInput("openness", "Openness To Strangers:",
                  min = 1, max = 5, value = 3)
    ),
    mainPanel(
      plotOutput("barplot")
    )
  )
)

# Define the server logic
server <- function(input, output) {
  output$barplot <- renderPlot({
    filtered_data <- breed_traits_filtered %>%
      filter(`Watchdog/Protective Nature` == input$watchdog,
             `Openness To Strangers` == input$openness) %>%
      group_by(`Watchdog/Protective Nature`, `Openness To Strangers`) %>%
      summarize(avg_Barking_Level = mean(`Barking Level`))

    ggplot(filtered_data, aes(x = factor(`Watchdog/Protective Nature`), y = avg_Barking_Level, fill = factor(`Openness To Strangers`))) +
      geom_bar(stat = "identity") +
      labs(x = "Watchdog/Protective Nature", y = "Average Barking Level", fill = "Openness To Strangers") +
      geom_text(aes(label = round(avg_Barking_Level, 2)), vjust = -0.5, size = 3) +
      scale_y_continuous(limits = c(0, 5))
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)
 

 
```

### Model diagnostics
#### Build the more complex model

In order to test the more complex model for outliers and to test the assumptions first we build the model.

```{r}
complex_model <- lm(`Barking Level` ~ `Watchdog/Protective Nature` + `Openness To Strangers` + `Affectionate With Family` + `Good With Young Children` + `Good With Other Dogs` + `Playfulness Level` + `Adaptability Level` + `Trainability Level` + `Energy Level` + `Mental Stimulation Needs`, data = breed_traits_filtered)


```

#### Checking for influential outliers

Check for outlier values in the model. Over 1 cook's distance the drog breed would be considered an outlier.

```{r}
# Set the default print options to show more columns
options(dplyr.width = Inf)


complex_model %>%
  augment() %>%
  select(`Watchdog/Protective Nature`,`Openness To Strangers`, `Affectionate With Family`, `Good With Young Children`, `Playfulness Level`, `Adaptability Level`, `Trainability Level`, `Energy Level`,`Good With Other Dogs`, `Mental Stimulation Needs`, cooks.dist = .cooksd) %>%
  arrange(desc(cooks.dist)) %>%
  head(10)

# As we can see every cook's distance value is well below zero, so we do not have outliers.
```

#### Checking assumptions

Check the normality assumption.

```{r}
plot(complex_model, which = 2)
```

Check the linearity assumption.

```{r}
plot(complex_model, which = 1)
```

Check the homoscedasticty assumption (homogeneity of variance).

```{r}
plot(complex_model, which = 3) # It seems the variance of the Barking Level is middle heavy on the measuring scale
```

Checking the multicollinearity assumption. Over 5 VIF some variables are strongly correlated and we should reduce our model.



```{r}
# Calculate VIF
vif(complex_model) # Every one of our variables are well below zero, so we have not encountered high multicorrealianity in our model. Therefore we will not drop any of our predictor from the more complex model.
```


## Model comparison

Create the simple model and get the results of the model that needs to be reported based on the What to report section.

```{r}
null_model <- lm(`Barking Level` ~ `Watchdog/Protective Nature` + `Openness To Strangers`, data = breed_traits_filtered)

summary(null_model)

glance(null_model) # Adjusted R squaired = 0.005549515 AIC = 590.5808
```

Create the more complex model based on the results of the model diagnostics. Also, get the results that needs to be reported based on the What to report section.

```{r}
summary(complex_model)

glance(complex_model) # Adjusted R squaired = 0.02654137	 AIC = 594.1411
```

Compare the two models. 

The null model regression equation: Barking Level = 2.49358 + 0.02433 * Watchdog/Protective Nature + 0.15770 * Openness To Strangers


The complex model regression equation: Barking Level = 0.994692 + 0.031533 * Watchdog/Protective Nature + 0.038626 * Openness To Strangers - 0.079730 * Affectionate With Family + 0.054527 * Good With Young Children - 0.007455 * Good With Other Dogs + 0.136785 * Playfulness Level + 0.264693 * Adaptability Level - 0.102140 * Trainability Level + 0.203117 * Energy Level + 0.052016 * Mental Stimulation Needs

The coefficients are representing the estimated effect of each predictor variable on the response variable (Barking Level).

```{r}
anova(null_model,complex_model) # F-statistic = 1.5148 p-value = 0.1546
```
## Discussion

Null Model:

Adjusted R-squared: 0.005549515

AIC: 590.5808

Complex Model:

Adjusted R-squared: 0.02654137	 AIC = 594.1411 

AIC:594.1411  

F-statistic: 1.5148 

p-value: 0.1546 

In terms of explaining the variance in barking level's variability in the sample, the complex_model performs better compared to the null model as it has a higher Adjusted R-squared value. 

The likelihood ratio test involves comparing the log-likelihood values of the two models and evaluating the difference in AIC. The model with the lower AIC is considered to have a better fit. In this case it is the null model.

The F-test is used to assess the overall significance of the additional predictors in model 2. In this case, with a p-value of 0.1546, we fail to reject the null hypothesis that the additional predictors have no effect on the response variable. This suggests that the additional predictors in model 2 do not significantly improve the model's fit compared to model 1.

Although the complex model explains higher variability in the sample, the null model has lower AIC values, and the F-test indicates, that the additional predictors are not improving the null model in a statistically significant way. 2 test states from the 3, that the null model is better to predict the barking level of the dogs, therefore we would use the null model if we have to chose from those two model.   



